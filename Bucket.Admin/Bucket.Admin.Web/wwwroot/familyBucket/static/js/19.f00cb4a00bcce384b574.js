webpackJsonp([19],{"1l/r":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r("neLP"),n={props:{value:{type:Boolean,default:!1},modelForm:{type:Object},menusList:{type:Array},platformList:{type:Array}},data:function(){return{defaultProps:{children:"children",label:"label"},apiTreeList:[],apiTreeCheck:[],show:!1,btnName:"新建",rules:{PlatformKey:[{required:!0,message:"请选择所属平台",trigger:"blur"}],Name:[{required:!0,message:"请输入角色名称",trigger:"blur"}],Key:[{required:!0,message:"请输入角色标识",trigger:"blur"}]}}},created:function(){this.BLL=new a.a(this),this.value&&(this.show=!0,this.BLL.searchApiList(),this.BLL.editInit())},computed:{loading:function(){return this.$store.getters.btnLoading.str&&"edit"===this.$store.getters.btnLoading.id}},mounted:function(){},methods:{handleReset:function(){this.$refs.modelForm.resetFields()},handleSubmit:function(e){this.BLL.editSubmit(e)}},watch:{show:function(e){var t=this;this.$emit("input",e),e?this.$nextTick(function(){t.BLL.editInit(),t.modelForm.Id?t.btnName="编辑":t.btnName="新建"}):(this.$refs.modelForm.clearValidate(),this.$refs.apiTree.setCheckedKeys([]),this.$refs.menusTree.setCheckedKeys([]))},value:function(e){this.show=e}}},i={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("el-dialog",{staticStyle:{"padding-right":"24px"},attrs:{title:e.btnName,visible:e.show,"close-on-click-modal":!1,width:"50%"},on:{"update:visible":function(t){e.show=t}}},[e.modelForm?r("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"modelForm",attrs:{model:e.modelForm,rules:e.rules,"label-width":"120px"}},[r("el-row",[r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:"所属项目",prop:"ProjectName"}},[r("el-select",{attrs:{placeholder:"请选择项目"},on:{change:function(t){e.BLL.searchApiList()}},model:{value:e.modelForm.PlatformKey,callback:function(t){e.$set(e.modelForm,"PlatformKey",t)},expression:"modelForm.PlatformKey"}},e._l(e.platformList,function(e){return r("el-option",{key:e.Key,attrs:{label:e.Name,value:e.Key}})}))],1)],1),e._v(" "),r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:"是否禁用",prop:"IsDel"}},[r("el-switch",{attrs:{"active-text":"禁用","active-color":"#F56C6C","inactive-color":"#F2F6FC"},model:{value:e.modelForm.IsDel,callback:function(t){e.$set(e.modelForm,"IsDel",t)},expression:"modelForm.IsDel"}})],1)],1)],1),e._v(" "),r("el-row",[r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:"角色名称",prop:"Name"}},[r("el-input",{model:{value:e.modelForm.Name,callback:function(t){e.$set(e.modelForm,"Name",t)},expression:"modelForm.Name"}})],1)],1),e._v(" "),r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:"角色标识",prop:"Key"}},[r("el-input",{model:{value:e.modelForm.Key,callback:function(t){e.$set(e.modelForm,"Key",t)},expression:"modelForm.Key"}})],1)],1)],1),e._v(" "),r("el-form-item",{attrs:{label:"备注",prop:"Remark"}},[r("el-input",{attrs:{type:"textarea"},model:{value:e.modelForm.Remark,callback:function(t){e.$set(e.modelForm,"Remark",t)},expression:"modelForm.Remark"}})],1),e._v(" "),e.menusList?r("el-form-item",{attrs:{label:"菜单权限"}},[r("el-tree",{ref:"menusTree",attrs:{data:e.menusList,"show-checkbox":"","node-key":"id","highlight-current":"",props:e.defaultProps}})],1):e._e(),e._v(" "),e.apiTreeList?r("el-form-item",{attrs:{label:"接口权限"}},[r("el-tree",{ref:"apiTree",attrs:{data:e.apiTreeList,"show-checkbox":"","node-key":"id","default-checked-keys":e.apiTreeCheck,"highlight-current":"",props:e.defaultProps}})],1):e._e(),e._v(" "),r("el-form-item",[r("el-button",{attrs:{type:"primary"},on:{click:e.handleSubmit}},[e._v(e._s(e.btnName))]),e._v(" "),r("el-button",{on:{click:e.handleReset}},[e._v("重置")])],1)],1):e._e()],1)},staticRenderFns:[]};var s=r("VU/8")(n,i,!1,function(e){r("uEwd")},null,null);t.default=s.exports},neLP:function(e,t,r){"use strict";var a=r("Dd8w"),n=r.n(a),i=r("Xxa5"),s=r.n(i),o=r("exGp"),l=r.n(o),u=r("Zx67"),c=r.n(u),m=r("Zrlr"),d=r.n(m),p=r("wxAW"),f=r.n(p),h=r("zwoO"),v=r.n(h),y=r("Pf15"),b=r.n(y),k=r("hky6");function L(e){var t=[];return e.forEach(function(e){0===e.ParentId&&1===e.State&&t.push({label:e.Name,id:e.Id,children:[]})}),e=e.filter(function(e){return 0!==e.ParentId||1!==e.State}),t.forEach(function(t){e.forEach(function(e){t.id===e.ParentId&&1===e.State&&t.children.push({id:e.Id,label:e.Name,parent:e.ParentId})})}),t}var w=function(e){function t(){return d()(this,t),v()(this,(t.__proto__||c()(t)).apply(this,arguments))}return b()(t,e),f()(t,[{key:"init",value:function(){var e=l()(s.a.mark(function e(){var t;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.vm.$api.xHttp.all([k.a.QueryPlatforms({load:!1}),k.a.QueryAllMenus("",{load:!1})]);case 2:(t=e.sent)&&(this.vm.platformList=t[0].Data,this.vm.menusList=L(t[1].Data));case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"search",value:function(){var e=l()(s.a.mark(function e(){var t,r;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.vm.filters,e.next=3,k.a.QueryAllRoles(t);case 3:(r=e.sent)&&(this.vm.dataList=r.Data);case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"add",value:function(){this.vm.editModel={RealName:null,UserName:null,Mobile:null,Email:null,State:0},this.vm.showEdit=!0}},{key:"editInit",value:function(){var e=l()(s.a.mark(function e(){var t,r,a,n=this;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.vm.modelForm.Id){e.next=5;break}return e.next=3,k.a.QueryRoleInfo({RoleId:this.vm.modelForm.Id},{load:!1});case 3:(t=e.sent)&&(r=t.Data.MenuList.filter(function(e){return!n.vm.menusList.find(function(t){return t.id===e.MenuId&&0!==t.children.length})}),this.vm.$refs.menusTree.setCheckedNodes(r.map(function(e){return{id:e.MenuId}})),a=[],t.Data.ApiList.forEach(function(e){a.push(e.ApiId)}),this.vm.apiTreeCheck=a);case 5:this.searchApiList();case 6:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"searchApiList",value:function(){var e=l()(s.a.mark(function e(){var t,r,a;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t={PageSize:1e4},e.next=3,k.a.QueryApiList(t,{load:!1});case 3:(r=e.sent)&&(a=[],r.Data.forEach(function(e){2===e.AllowScope&&a.push({label:e.ProjectName+"/"+e.Controller+"/"+e.Message,id:e.Id,children:[]})}),this.vm.apiTreeList=a);case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"editSubmit",value:function(){var e,t=this;this.vm.$refs.modelForm.validate((e=l()(s.a.mark(function e(r){var a,i,o;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!r){e.next=11;break}return a={loadID:"edit"},i=[],t.vm.$refs.menusTree.getCheckedNodes(!1).forEach(function(e){i.push(e.id),e.parent&&(i.includes(e.parent)||i.push(e.parent))}),o=t.vm.$refs.apiTree.getCheckedKeys(),e.next=7,k.a.SetRoleInfo(n()({},t.vm.modelForm,{MenuIdList:i.filter(function(e){return!isNaN(e)}),ApiIdList:o}),a);case 7:e.sent&&(t.vm.show=!1,t.vm.$emit("addSuccess"),t.vm.$notify({title:"成功",message:"操作成功",type:"success"})),e.next=12;break;case 11:return e.abrupt("return",!1);case 12:case"end":return e.stop()}},e,t)})),function(t){return e.apply(this,arguments)}))}}]),t}(r("ARvU").a);t.a=w},uEwd:function(e,t){}});